# UDP Test Tools

UDPパケットの送受信テストを行うためのツールセットです。パケットロス率や遅延時間の測定ができます。

## ビルド

```bash
make
```

## プログラム

### udp_tx (送信)

UDPパケットを送信するプログラムです。Raw socketを使用してIPヘッダを含めたパケットを生成します。

```bash
./udp_tx [options]
```

**オプション:**
- `-s IP4_ADDRESS` : 送信元アドレス (デフォルト: 0.0.0.0)
- `-d IP4_ADDRESS` : 宛先アドレス (デフォルト: 192.168.0.158)
- `-c SECONDS` : 送信時間（秒） (デフォルト: 10)
- `-t TOS` : TOS優先度 0-7 (デフォルト: 0)
- `-p PORT_NUMBER` : ポート番号 (デフォルト: 44444)
- `-o PPS` : 1秒あたりのパケット数 (デフォルト: 1000)
- `-l UDP_PAYLOAD_SIZE` : UDPペイロードサイズ (デフォルト: 1000)
- `-x LAP_INTERVAL` : ラップ表示間隔 (デフォルト: 100)
- `-n` : 受信側を停止させない

### udp_rx (受信)

UDPパケットを受信するプログラムです。パケットロス率や遅延時間を計測します。

```bash
./udp_rx [options]
```

**オプション:**
- `-p PORT_NUMBER` : ポート番号 (デフォルト: 44444)
- `-n` : 受信を継続（終了パケットで停止しない）
- `-l` : ログを有効化（`./log/`ディレクトリに保存）

### udp_trx (送受信)

UDPパケットを受信し、送信元に返送するトランシーバープログラムです。往復遅延時間（RTT）の測定に使用できます。

```bash
./udp_trx [options]
```

**オプション:**
- `-d IP4_ADDRESS` : 宛先アドレス (デフォルト: 192.168.1.1)
- `-p PORT_NUMBER` : ポート番号 (デフォルト: 44444)
- `-n` : 受信を継続

## 分析ツール

### grap_lap.py

ログファイルからラップデータを抽出し、線形回帰を行ってグラフ表示するPythonスクリプトです。

```bash
python3 grap_lap.py <logfile>
```

**依存パッケージ:**
- numpy
- matplotlib

## 使用例

受信側で起動:
```bash
./udp_rx -p 44444
```

送信側で実行:
```bash
./udp_tx -d 192.168.0.100 -p 44444 -o 1000 -c 10
```

## パケットフォーマット

| オフセット | サイズ | 内容 |
|-----------|--------|------|
| 0 | 1 | パケット種別 (S/C/L/E/F) |
| 1 | 1 | TOS |
| 2 | 2 | ペイロードサイズ |
| 4 | 4 | 送信時刻 (秒) |
| 8 | 4 | 送信時刻 (マイクロ秒) |
| 12 | 4 | カウンタ |

**パケット種別:**
- `S` : Start（開始）
- `C` : Continue（継続）
- `L` : Lap（ラップ）
- `E` : End（終了）
- `F` : Finish（完了）

## ライセンス

このプロジェクトのライセンスについては、リポジトリの所有者にお問い合わせください。
